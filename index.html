<!DOCTYPE html>
<html>
<head>
    <title>Food Security in BC</title>
    <link rel="stylesheet" href="leaflet.css" />
    <script src="leaflet.js"></script>
    <script src="d3.v3.min.js"></script>
    <script src="L.D3SvgLeaflet.min.js"></script>
    <style>
        #map { width: 800px; height: 900px; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        a { color: #0077ff; }
    </style>
</head>
<body>

<div id="map"></div>

<!-- <script src="simpleheat.js"></script>
<script src="HeatLayer.js"></script> -->

<script src="leaflet-heat.js"></script>

<script src="BCpopdensity2011.js"></script>
<script>


function toTitleCase(str) {
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
};

var map = L.map('map').setView([54.15,-126.55], 6);

var tiles = L.tileLayer('http://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
    attribution: '<a href="https://www.mapbox.com/about/maps/">Terms and Feedback</a>',
    id: 'examples.map-20v6611k'
}).addTo(map);

var heat = L.heatLayer(popPoints,{
    radius: 25,
    blur: 35,
    //maxZoom: 40,
}).addTo(map);


var stores = [];
var storesOverlay = L.d3SvgOverlay(function(sel,proj){
	
  var storesUpd = sel.selectAll('circle').data(stores);
  storesUpd.enter()
    .append('circle')
    .attr('r',5)
    .attr('cx',function(d){return proj.latLngToLayerPoint(d.latLng).x;})
    .attr('cy',function(d){return proj.latLngToLayerPoint(d.latLng).y;})
    .attr('fill','blue')
    .append("svg:title")
      .text(function(d) { return toTitleCase(d.NAME); });
});

d3.csv("BC_Food.csv",function(data){
    console.log(data.length);
  stores = data.map(function(d){
    d.latLng = [+d.lat,+d.lng];
    return d;
  });
  storesOverlay.addTo(map);
});



</script>
</body>
</html>
